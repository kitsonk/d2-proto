<!DOCTYPE html>
<html>
<head>
	<title>Demonstration: d2-proto/compose</title>
	<style type="text/css">
	@import "../../dijit/themes/claro/claro.css";
	@import "../../dijit/themes/claro/document.css";

	html {
		min-height: 100%;
	}

	body {
		padding: 1em;
		background-image: linear-gradient(rgb(152,192,237), rgb(239,239,239) 250px);
		background-image: -webkit-linear-gradient(rgb(152,192,237), rgb(239,239,239) 250px);
	}
	</style>
	<script type="text/javascript">

	function clickMe(e){
		console.log("clicked");
	}

	dojoConfig = {
		async: 1,
		isDebug: 1,
		pacakges: [{
			name: "dojo",
			location: "dojo"
		},{
			name: "dijit",
			location: "dijit"
		},{
			name: "d2-proto",
			location: "d2-proto"
		}]
	};
	</script>
	<script type="text/javascript" src="../../dojo/dojo.js"></script>
	<script type="text/javascript">
	require(["d2-proto/compose"], function(compose){
		var property = compose.property,
			after = compose.after,
			nodeValue,
			getCall = 0,
			setCall = 0;

		console.log('Widget');

		var Widget = compose(function (node) {
			this.node = node;
		}, {
			node: property({
				get: function () {
					return nodeValue;
				},
				set: function (value) {
					nodeValue = value;
				},
				enumerable: true
			})
		});

		console.log('SubWidget');

		var SubWidget = compose(Widget, {
			node: property({
				get: after(function () {
					getCall++;
				}),
				set: after(function () {
					setCall++;
				}),
				enumerable: true
			})
		});

		console.log('creation');

		var widget = new SubWidget();
		widget.node = {};
		console.log(widget.node);
		console.log(setCall, getCall);
		var propertyDescriptor = Object.getOwnPropertyDescriptor(widget, 'node');
		console.log(propertyDescriptor.get);
	});
	</script>
</head>
<body class="claro">
	<h1>Demonstration: d2-proto/compose</h1>
</body>
